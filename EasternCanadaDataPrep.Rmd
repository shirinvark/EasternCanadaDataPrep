---
title: "EasternCanadaDataPrep Manual"
subtitle: "Eastern Canada spatial data preparation"
date: "Last updated: 2025-12-15"
output:
  bookdown::html_document2:
    toc: true
    toc_float: true
    theme: sandstone
    number_sections: false
---

# EasternCanadaDataPrep Module

## Executive summary

**EasternCanadaDataPrep** is a SpaDES module that constructs a **raster-based landbase accounting framework**
for forest modelling applications in Eastern Canada.

The module defines *where harvesting is spatially permissible* by applying **legal and physical constraints**
to a wall-to-wall planning raster.  
It does **not** perform forest classification, yield modelling, or harvest allocation.

This module is intentionally limited to **spatial accounting only** and produces inputs required by
downstream modules such as LandR, AAC calculation, and harvest scheduling.

### What this module does

- Defines a consistent Eastern Canada study area  
- Loads and harmonizes Forest Management Units (FMUs)  
- Loads and filters protected and conserved areas (CPCAD)  
- Derives a wall-to-wall raster representation of riparian influence  
- Constructs a coarse-resolution planning raster (default: 250 m)  
- Produces a cell-based landbase accounting table with effective harvestable area  

### What this module does **not** do

- Does **not** download or process land-cover data  
- Does **not** classify forest types  
- Does **not** calculate yield or biomass  
- Does **not** allocate or schedule harvest  
- Does **not** apply management decisions  

All ecological interpretation and harvest decisions are explicitly deferred to downstream modules.

---

## Module workflow

┌──────────────────────────┐
│ Study Area │
└─────────────┬────────────┘
│
┌─────────────▼────────────┐
│ Forest Management Units │
│ (FMU polygons) │
└─────────────┬────────────┘
│
┌─────────────▼────────────┐
│ Protected Areas (CPCAD) │
│ Legal exclusions │
└─────────────┬────────────┘
│
┌─────────────▼────────────┐
│ Hydrology (HydroRIVERS) │
│ → Riparian fraction │
└─────────────┬────────────┘
│
┌─────────────▼────────────┐
│ Planning Raster (250 m) │
│ FMU × CPCAD constraints │
└─────────────┬────────────┘
│
┌─────────────▼────────────┐
│ Landbase Accounting │
│ Cell-based table with │
│ effective harvest area │
└─────────────┬────────────┘
│
┌─────────────▼────────────┐
│ Output to downstream │
│ (LandR, AAC, harvest) │
└──────────────────────────┘


---

## Design principles

This module follows four core design principles:

1. **Raster-first**  
   All landbase accounting is performed on a wall-to-wall raster grid to ensure scalability.

2. **Separation of concerns**  
   Spatial constraints are handled here; ecological meaning and decisions are handled downstream.

3. **Legal, not ecological, harvestability**  
   “Harvestable” means *not legally excluded*, not “forested” or “operable”.

4. **Transparency and reproducibility**  
   All area calculations are explicit, traceable, and reproducible.

---

## External dependencies

### Land cover (upstream dependency)

Land cover is treated as a **strict upstream dependency**.

This module does **not** download, preprocess, reclassify, or interpret land-cover data.
A categorical land-cover raster must be supplied by an upstream module if required by
downstream applications.

Expected characteristics (if provided):

- Object name: `sim$LandCover`
- Type: `terra::SpatRaster`
- Projection: ESRI:102001
- Resolution: finer than the planning resolution

Land cover is **not required** for constructing the legal harvestable mask in this module.

---

## Forest Management Units (FMUs)

Forest Management Units are loaded as vector polygons and harmonized to the study area
extent and projection.

FMUs define the administrative units for which landbase accounting is performed.
They are rasterized to the planning grid and used to associate each planning cell
with a management unit.

---

## Protected and conserved areas (CPCAD)

Protected and conserved areas are derived from the Canadian Protected and Conserved Areas Database (CPCAD).

The CPCAD layer is:

- Cropped and masked to the study area  
- Reprojected to ESRI:102001  
- Filtered to retain only legally relevant exclusions  

These areas represent **non-harvestable land by policy** and are applied as a binary exclusion
in the harvestable mask.

---

## Hydrology — riparian influence

Hydrology is represented as a **fractional raster of riparian influence**, not as explicit
hydrological features.

### Rationale

National hydrology vector datasets are too large and complex for repeated use in
regional-to-national raster modelling workflows.

Instead, hydrology is represented by its *spatial influence on land area*.

### Data source

Riparian influence is derived from **HydroRIVERS (HydroSHEDS)** and used only as
an intermediate input.

### Processing steps

1. Load HydroRIVERS flowlines and crop to the study area  
2. Apply a uniform buffer (`riparianBuffer_m`)  
3. Rasterize buffered features to a coarse grid (`hydroRaster_m`)  
4. Compute fractional pixel overlap  

### Output

```r
sim$Hydrology <- list(
  source = "HydroRIVERS_v10_na",
  buffer_m = <buffer distance>,
  raster_m = <resolution>,
  riparianFraction = <SpatRaster [0–1]>
)
Planning raster
The planning raster is a coarse-resolution grid (default: 250 m) that defines the
spatial units used for landbase accounting.

It is constructed by:

Creating a wall-to-wall raster template

Masking to FMUs

Applying protected-area exclusions

No ecological classification is applied at this stage.

Landbase accounting table
A cell-based accounting table is constructed from the planning raster.

Each row represents one planning cell and records:

FMU identifier

Cell area (m²)

Riparian fraction (0–1)

Effective harvestable area after constraints

This table enables transparent area calculations without repeated raster processing.

Harvestable Land Base (HLB) — legacy / optional
Vector-based Harvestable Land Base (HLB) construction is retained for
development and validation purposes only.

The primary landbase representation in this module is raster-based.

Module outputs
Primary outputs include:

Planning raster

Harvestable mask raster

Riparian fraction raster

Landbase accounting table

Structured landbase object for downstream use

Relationship to other modules
This module must be run before:

LandR forest dynamics modules

AAC calculation modules

Harvest scheduling and allocation modules

It provides spatial constraints only and makes no assumptions about forest condition
or management objectives.

Summary
EasternCanadaDataPrep defines where harvest could legally occur,
not where it should occur.

This distinction ensures a clean, modular, and scalable modelling architecture.

